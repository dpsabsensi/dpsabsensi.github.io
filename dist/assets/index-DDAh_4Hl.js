(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function c(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(e){if(e.ep)return;e.ep=!0;const a=c(e);fetch(e.href,a)}})();const O="08:00",H="16:00",J="14:00",$=5,R=5e3;document.getElementById("upload-form").addEventListener("submit",async function(r){r.preventDefault();const s=document.querySelector('input[type="file"]'),c=new FormData;c.append("csvFile",s.files[0]);const t=document.getElementById("message");t.innerText="‚è≥ Uploading...";try{const a=await(await fetch("https://pusatpneumatic.com/absen/upload.php",{method:"POST",body:c})).text();let n;try{n=JSON.parse(a)}catch(i){console.error("Error parsing JSON dari upload.php:",i.message,a),t.innerText="‚ùå Upload gagal: Respons server bukan JSON valid. Periksa console log.";return}if(!n.success){t.innerText="‚ùå Upload gagal: "+n.message;return}const o=n.filename;t.innerText="üìÅ File di-upload, mulai parse...";const p=new FormData;p.append("filename",o);const g=await(await fetch("https://pusatpneumatic.com/absen/parse.php",{method:"POST",body:p})).text();console.log("Raw response dari parse.php:",g);let m;try{m=JSON.parse(g)}catch(i){console.error("Error parsing JSON dari parse.php:",i.message,g),t.innerText="‚ùå Parse gagal: Respons server bukan JSON valid. Periksa console log.";return}if(!m.success){t.innerText="‚ö†Ô∏è Parsing gagal: "+m.message;return}t.innerText="‚úÖ Sukses! Data berhasil diparse"}catch(e){t.innerText="‚ùå Terjadi kesalahan: "+e.message}});function T(r){if(!r||typeof r!="string")return null;const[s,c]=r.split(":").map(Number);return s*60+c}function v(r){const s=Math.floor(r/60),c=r%60;return`${s}j ${c}m`}function K(r){const[s,c,t]=r.split("-").map(Number);return new Date(s,c-1,t).getDay()===6}function C(r){return r<=5?0:r<=15?1e4:r<=30?25e3:r<=60?5e4:1e5}let P=new Set;function A(r){return P.has(r)}function _(r,s){const c=[],t=new Date(r,s,0).getDate();for(let e=1;e<=t;e++){const a=`${r}-${String(s).padStart(2,"0")}-${String(e).padStart(2,"0")}`;new Date(`${a}T00:00:00`).getDay()!==0&&(A(a)||c.push(a))}return console.log("[AUDIT] Hari kerja ideal (kalender):",c.length),c}function F({summaryId:r,detailId:s,tabSummaryId:c,tabDetailId:t}){const e=document.getElementById(c),a=document.getElementById(t),n=document.getElementById(r),o=document.getElementById(s);e.addEventListener("click",()=>{n.classList.remove("hidden"),o.classList.add("hidden"),e.classList.replace("bg-gray-200","bg-blue-600"),e.classList.replace("text-gray-700","text-white"),a.classList.replace("bg-blue-600","bg-gray-200"),a.classList.replace("text-white","text-gray-700")}),a.addEventListener("click",()=>{n.classList.add("hidden"),o.classList.remove("hidden"),a.classList.replace("bg-gray-200","bg-blue-600"),a.classList.replace("text-gray-700","text-white"),e.classList.replace("bg-blue-600","bg-gray-200"),e.classList.replace("text-white","text-gray-700")})}function U(r){const s=[];for(const c in r){const t=r[c],e=t.find(o=>o.type==="in")?.time||null,a=[...t].reverse().find(o=>o.type==="out")?.time||null,n=[];for(let o=0;o<t.length-1;o++)if(t[o].type==="out"&&t[o+1].type==="in"){const p=T(t[o+1].time)-T(t[o].time);p>0&&n.push(p)}s.push({tanggal:c,jamMasuk:e,jamKeluar:a,breaks:n,isEmpty:!e&&!a,holiday:A(c)})}return s}function q(r){const s=r.map(l=>l.tanggal),c=T(O),t=s[0].split("-")[0],e=s[0].split("-")[1],a=_(Number(t),Number(e)),n=new Set;let o=0,p=0,j=0,g=0,m=0,i=0,S=0,L=0;for(const l of r){const d=T(K(l.tanggal)?J:H),x=A(l.tanggal),f=T(l.jamMasuk),h=T(l.jamKeluar),E=h-f;if(x&&(L++,!l.jamMasuk&&!l.jamKeluar))continue;if(f===null||h===null){S++;continue}n.add(l.tanggal),o+=E;const k=f-c;k>$&&(m+=k,g+=C(k));const M=d-h;M>$&&(i+=M);const N=h-d;N>$&&(p+=N),j+=l.breaks.reduce((B,I)=>B+I,0)}const D=a.filter(l=>!n.has(l)).length,u=Math.floor(p/60)*R,y=Math.max(u-g,0),b=a.reduce((l,d)=>{const x=T(K(d)?J:H),f=T(O);return l+(x-f)},0);return console.log("[AUDIT] Total menit kerja ideal:",b,"menit"),console.log("[AUDIT] Total jam kerja ideal:",(b/60).toFixed(2),"jam"),{workMinutes:o,workHours:v(o),lemburHours:v(p),uangLemburKotor:u,jamKerjaIdeal:v(b),dendaTelat:g,uangLembur:y,telatHours:v(m),earlyOutHours:v(i),absenceDays:D,missingDays:S,holidayDays:L,breakHours:v(j)}}document.addEventListener("DOMContentLoaded",async()=>{function r(){const t=document.getElementById("yearSelect")?.value,e=document.getElementById("monthSelect")?.value;return`https://pusatpneumatic.com/absen/json/${t}/${t}-${e}.json`}async function s(){const t=r();try{let S=function(){const u=p.value.toLowerCase();i.querySelectorAll("tr").forEach(y=>{const b=y.children[0].textContent.toLowerCase(),l=y.children[1].textContent.replaceAll("\\/","/"),d=new Date(l),x=b.includes(u);y.style.display=x?"":"none"}),g.querySelectorAll("tr").forEach(y=>{const l=y.children[0].textContent.toLowerCase().includes(u);y.style.display=l?"":"none"})},D=function(u,y=!1){const b=Array.from(i.querySelectorAll("tr")),l=L[u]==="asc"?"desc":"asc";L[u]=l,b.sort((d,x)=>{const f=d.children[u].textContent.trim(),h=x.children[u].textContent.trim();let E;return y?E=new Date(f)-new Date(h):!isNaN(f)&&!isNaN(h)?E=Number(f)-Number(h):E=f.localeCompare(h),l==="asc"?E:-E}),i.innerHTML="",b.forEach(d=>i.appendChild(d))};var e=S,a=D;const n=await fetch(t);if(!n.ok)throw new Error("Gagal memuat data JSON");const o=await n.json(),p=document.getElementById("filterName"),j=document.getElementById("summaryHead"),g=document.getElementById("summaryBody"),m=document.getElementById("detailHead"),i=document.getElementById("detailBody");g.innerHTML="",i.innerHTML="",o.forEach(u=>{const{nama:y,logs:b}=u,l=U(u.logs),d=q(l);j.innerHTML=`
          <tr>
            <th class="px-4 py-3 border-b text-left">Nama</th>
            <th class="px-4 py-3 border-b text-center">Work<br>(${d.jamKerjaIdeal} jam)</th>
            <th class="px-4 py-3 border-b text-center">Lembur (jam)</th>
            <th class="px-4 py-3 border-b text-center">Uang Lembur</th>
            <th class="px-4 py-3 border-b text-center">Telat (jam)</th>
            <th class="px-4 py-3 border-b text-center">Early Out</th>
            <th class="px-4 py-3 border-b text-center">Absence</th>
            <th class="px-4 py-3 border-b text-center">Break (jam)</th>
          </tr>
        `,m.innerHTML=`
          <tr class="bg-gradient-to-r from-blue-200 to-blue-400 text-gray-800 font-semibold text-sm shadow-sm">
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="nama">Nama</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="tanggal">Tanggal</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Masuk</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Break-In</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Break-Out</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Keluar</th>
            <th class="px-1 py-3 border-b border-gray-300 text-center cursor-pointer rounded-tr-lg w-30" data-sort="keluar">MT</th>
          </tr>
        `,Object.entries(b).forEach(([f,h])=>{const E=h.find(w=>w.type==="in")?.time||"-",k=h.slice().reverse().find(w=>w.type==="out")?.time||"-",M=h.find(w=>w.type==="break-in")?.time||"-",N=h.slice().reverse().find(w=>w.type==="break-out")?.time||"-",B=E==="-"||k==="-"?"‚ö†Ô∏è":"",I=document.createElement("tr");I.className="hover:bg-blue-50 transition-colors",I.innerHTML=`
            <td class="px-4 py-3 border-b text-sm font-medium text-gray-700">${y}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-gray-600">${f.replaceAll("\\/","/")}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-green-700 font-semibold">${E}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${M}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${N}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${k}</td>
            <td class="px-4 py-3 border-b text-center text-sm">${B}</td>
          `,i.appendChild(I)});const x=document.createElement("tr");x.className="hover:bg-blue-50 transition-colors",x.innerHTML=`
          <td class="px-4 py-3 text-sm font-medium text-gray-800">${u.nama}</td>
          <td class="px-4 py-3 text-center">${d.workHours}</td>
          <td class="px-4 py-3 text-center text-green-700 font-semibold">${d.lemburHours}</td>
          <td class="px-4 py-3 text-center font-semibold relative group cursor-pointer ${d.uangLembur<0?"text-red-700":"text-green-800"}">
            Rp${d.uangLembur.toLocaleString()}
            <div class="absolute z-10 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max px-3 py-1 bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
              Rp${d.uangLemburKotor.toLocaleString()} - Rp${d.dendaTelat.toLocaleString()}
            </div>
          </td>
          <td class="px-4 py-3 text-center text-red-700">${d.telatHours}</td>
          <td class="px-4 py-3 text-center">${d.earlyOutHours}</td>
          <td class="px-4 py-3 text-center">${d.absenceDays}</td>
          <td class="px-4 py-3 text-center">${d.breakHours}</td>
        `,g.appendChild(x)});let L={};m.querySelectorAll("th").forEach((u,y)=>{const b=u.dataset.sort;b&&u.addEventListener("click",()=>{D(y,b==="tanggal")})}),[p].forEach(u=>u.addEventListener("input",S))}catch(n){console.error("‚ùå Gagal memuat JSON:",n),document.getElementById("message").innerText="Gagal memuat data. Periksa file JSON."}}async function c(){const t=document.getElementById("yearSelect"),e=document.getElementById("monthSelect"),n=await(await fetch("https://pusatpneumatic.com/absen/json/list_index.json")).json();Object.keys(n).sort().forEach(m=>{const i=document.createElement("option");i.value=m,i.textContent=m,t.appendChild(i)}),t.addEventListener("change",()=>{const m=t.value,i=n[m]||[];e.innerHTML="",i.forEach(S=>{const L=document.createElement("option");L.value=S,L.textContent=S,e.appendChild(L)}),s()}),e.addEventListener("change",s);const o=new Date,p=o.getFullYear().toString(),j=String(o.getMonth()+1).padStart(2,"0");t.value=p;const g=n[p];g&&(g.forEach(m=>{const i=document.createElement("option");i.value=m,i.textContent=m,e.appendChild(i)}),e.value=j),s()}await c(),F({summaryId:"summaryTab",detailId:"detailTab",tabSummaryId:"tabSummary",tabDetailId:"tabDetail"})});
