(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function l(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(t){if(t.ep)return;t.ep=!0;const a=l(t);fetch(t.href,a)}})();const N="08:00",K="16:00",C="14:00",B=5,J=5e3;function j(e){if(!e||typeof e!="string")return null;const[n,l]=e.split(":").map(Number);return n*60+l}function T(e){const n=Math.floor(e/60),l=e%60;return`${n}j ${l}m`}function O(e){const[n,l,r]=e.split("-").map(Number);return new Date(n,l-1,r).getDay()===6}function _(e){return e<=5?0:e<=15?1e4:e<=30?25e3:e<=60?5e4:1e5}let R=new Set;function H(e){return R.has(e)}function P(e,n){const l=[],r=new Date(e,n,0).getDate();for(let t=1;t<=r;t++){const a=`${e}-${String(n).padStart(2,"0")}-${String(t).padStart(2,"0")}`;new Date(`${a}T00:00:00`).getDay()!==0&&(H(a)||l.push(a))}return console.log("[AUDIT] Hari kerja ideal (kalender):",l.length),l}function U({summaryId:e,detailId:n,tabSummaryId:l,tabDetailId:r}){const t=document.getElementById(l),a=document.getElementById(r),c=document.getElementById(e),s=document.getElementById(n);t.addEventListener("click",()=>{c.classList.remove("hidden"),s.classList.add("hidden"),t.classList.replace("bg-gray-200","bg-blue-600"),t.classList.replace("text-gray-700","text-white"),a.classList.replace("bg-blue-600","bg-gray-200"),a.classList.replace("text-white","text-gray-700")}),a.addEventListener("click",()=>{c.classList.add("hidden"),s.classList.remove("hidden"),a.classList.replace("bg-gray-200","bg-blue-600"),a.classList.replace("text-gray-700","text-white"),t.classList.replace("bg-blue-600","bg-gray-200"),t.classList.replace("text-white","text-gray-700")})}function F(e){const n=[];for(const l in e){const r=e[l],t=r.find(s=>s.type==="in")?.time||null,a=[...r].reverse().find(s=>s.type==="out")?.time||null,c=[];for(let s=0;s<r.length-1;s++)if(r[s].type==="out"&&r[s+1].type==="in"){const b=j(r[s+1].time)-j(r[s].time);b>0&&c.push(b)}n.push({tanggal:l,jamMasuk:t,jamKeluar:a,breaks:c,isEmpty:!t&&!a,holiday:H(l)})}return n}function q(e){const n=e.map(o=>o.tanggal),l=j(N),r=n[0].split("-")[0],t=n[0].split("-")[1],a=P(Number(r),Number(t)),c=new Set;let s=0,b=0,M=0,x=0,g=0,i=0,S=0,E=0;for(const o of e){const d=j(O(o.tanggal)?C:K),f=H(o.tanggal),h=j(o.jamMasuk),y=j(o.jamKeluar),L=y-h;if(f&&(E++,!o.jamMasuk&&!o.jamKeluar))continue;if(h===null||y===null){S++;continue}c.add(o.tanggal),s+=L;const w=h-l;w>B&&(g+=w,x+=_(w));const D=d-y;D>B&&(i+=D);const $=y-d;$>B&&(b+=$),M+=o.breaks.reduce((A,v)=>A+v,0)}const I=a.filter(o=>!c.has(o)).length,u=Math.floor(b/60)*J,m=Math.max(u-x,0),p=a.reduce((o,d)=>{const f=j(O(d)?C:K),h=j(N);return o+(f-h)},0);return console.log("[AUDIT] Total menit kerja ideal:",p,"menit"),console.log("[AUDIT] Total jam kerja ideal:",(p/60).toFixed(2),"jam"),{workMinutes:s,workHours:T(s),lemburHours:T(b),uangLemburKotor:u,jamKerjaIdeal:T(p),dendaTelat:x,uangLembur:m,telatHours:T(g),earlyOutHours:T(i),absenceDays:I,missingDays:S,holidayDays:E,breakHours:T(M)}}document.addEventListener("DOMContentLoaded",async()=>{function e(){const r=document.getElementById("yearSelect")?.value,t=document.getElementById("monthSelect")?.value;return`/data/json/${r}/${r}-${t}.json`}async function n(){const r=e();try{let S=function(){const u=b.value.toLowerCase();i.querySelectorAll("tr").forEach(m=>{const p=m.children[0].textContent.toLowerCase(),o=m.children[1].textContent.replaceAll("\\/","/"),d=new Date(o),f=p.includes(u);m.style.display=f?"":"none"}),x.querySelectorAll("tr").forEach(m=>{const o=m.children[0].textContent.toLowerCase().includes(u);m.style.display=o?"":"none"})},I=function(u,m=!1){const p=Array.from(i.querySelectorAll("tr")),o=E[u]==="asc"?"desc":"asc";E[u]=o,p.sort((d,f)=>{const h=d.children[u].textContent.trim(),y=f.children[u].textContent.trim();let L;return m?L=new Date(h)-new Date(y):!isNaN(h)&&!isNaN(y)?L=Number(h)-Number(y):L=h.localeCompare(y),o==="asc"?L:-L}),i.innerHTML="",p.forEach(d=>i.appendChild(d))};var t=S,a=I;const c=await fetch(r);if(!c.ok)throw new Error("Gagal memuat data JSON");const s=await c.json(),b=document.getElementById("filterName"),M=document.getElementById("summaryHead"),x=document.getElementById("summaryBody"),g=document.getElementById("detailHead"),i=document.getElementById("detailBody");x.innerHTML="",i.innerHTML="",s.forEach(u=>{const{nama:m,logs:p}=u,o=F(u.logs),d=q(o);M.innerHTML=`
          <tr>
            <th class="px-4 py-3 border-b text-left">Nama</th>
            <th class="px-4 py-3 border-b text-center">Work<br>(${d.jamKerjaIdeal} jam)</th>
            <th class="px-4 py-3 border-b text-center">Lembur (jam)</th>
            <th class="px-4 py-3 border-b text-center">Uang Lembur</th>
            <th class="px-4 py-3 border-b text-center">Telat (jam)</th>
            <th class="px-4 py-3 border-b text-center">Early Out</th>
            <th class="px-4 py-3 border-b text-center">Absence</th>
            <th class="px-4 py-3 border-b text-center">Break (jam)</th>
          </tr>
        `,g.innerHTML=`
          <tr class="bg-gradient-to-r from-blue-200 to-blue-400 text-gray-800 font-semibold text-sm shadow-sm">
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="nama">Nama</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="tanggal">Tanggal</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Masuk</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Break-In</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Break-Out</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Keluar</th>
            <th class="px-1 py-3 border-b border-gray-300 text-center cursor-pointer rounded-tr-lg w-30" data-sort="keluar">MT</th>
          </tr>
        `,Object.entries(p).forEach(([h,y])=>{const L=y.find(k=>k.type==="in")?.time||"-",w=y.slice().reverse().find(k=>k.type==="out")?.time||"-",D=y.find(k=>k.type==="break-in")?.time||"-",$=y.slice().reverse().find(k=>k.type==="break-out")?.time||"-",A=L==="-"||w==="-"?"⚠️":"",v=document.createElement("tr");v.className="hover:bg-blue-50 transition-colors",v.innerHTML=`
            <td class="px-4 py-3 border-b text-sm font-medium text-gray-700">${m}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-gray-600">${h.replaceAll("\\/","/")}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-green-700 font-semibold">${L}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${D}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${$}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${w}</td>
            <td class="px-4 py-3 border-b text-center text-sm">${A}</td>
          `,i.appendChild(v)});const f=document.createElement("tr");f.className="hover:bg-blue-50 transition-colors",f.innerHTML=`
          <td class="px-4 py-3 text-sm font-medium text-gray-800">${u.nama}</td>
          <td class="px-4 py-3 text-center">${d.workHours}</td>
          <td class="px-4 py-3 text-center text-green-700 font-semibold">${d.lemburHours}</td>
          <td class="px-4 py-3 text-center font-semibold relative group cursor-pointer ${d.uangLembur<0?"text-red-700":"text-green-800"}">
            Rp${d.uangLembur.toLocaleString()}
            <div class="absolute z-10 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max px-3 py-1 bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
              Rp${d.uangLemburKotor.toLocaleString()} - Rp${d.dendaTelat.toLocaleString()}
            </div>
          </td>
          <td class="px-4 py-3 text-center text-red-700">${d.telatHours}</td>
          <td class="px-4 py-3 text-center">${d.earlyOutHours}</td>
          <td class="px-4 py-3 text-center">${d.absenceDays}</td>
          <td class="px-4 py-3 text-center">${d.breakHours}</td>
        `,x.appendChild(f)});let E={};g.querySelectorAll("th").forEach((u,m)=>{const p=u.dataset.sort;p&&u.addEventListener("click",()=>{I(m,p==="tanggal")})}),[b].forEach(u=>u.addEventListener("input",S))}catch(c){console.error("❌ Gagal memuat JSON:",c),document.getElementById("message").innerText="Gagal memuat data. Periksa file JSON."}}async function l(){const r=document.getElementById("yearSelect"),t=document.getElementById("monthSelect"),c=await(await fetch("/data/json/list_index.json")).json();Object.keys(c).sort().forEach(g=>{const i=document.createElement("option");i.value=g,i.textContent=g,r.appendChild(i)}),r.addEventListener("change",()=>{const g=r.value,i=c[g]||[];t.innerHTML="",i.forEach(S=>{const E=document.createElement("option");E.value=S,E.textContent=S,t.appendChild(E)}),n()}),t.addEventListener("change",n);const s=new Date,b=s.getFullYear().toString(),M=String(s.getMonth()+1).padStart(2,"0");r.value=b;const x=c[b];x&&(x.forEach(g=>{const i=document.createElement("option");i.value=g,i.textContent=g,t.appendChild(i)}),t.value=M),n()}await l(),U({summaryId:"summaryTab",detailId:"detailTab",tabSummaryId:"tabSummary",tabDetailId:"tabDetail"})});
