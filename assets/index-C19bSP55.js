(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(e){if(e.ep)return;e.ep=!0;const a=s(e);fetch(e.href,a)}})();const R="08:00",O="16:00",H="14:00",B=5,J=5e3;document.getElementById("upload-form").addEventListener("submit",async function(r){r.preventDefault();const c=document.querySelector('input[type="file"]'),s=new FormData;s.append("csvFile",c.files[0]);const t=document.getElementById("message");t.innerText="‚è≥ Uploading...";try{const a=await(await fetch("https://pusatpneumatic.com/absen/upload.php",{method:"POST",body:s})).text();let n;try{n=JSON.parse(a)}catch(i){console.error("Error parsing JSON dari upload.php:",i.message,a),t.innerText="‚ùå Upload gagal: Respons server bukan JSON valid. Periksa console log.";return}if(!n.success){t.innerText="‚ùå Upload gagal: "+n.message;return}const o=n.filename;t.innerText="üìÅ File di-upload, mulai parse...";const p=new FormData;p.append("filename",o);const g=await(await fetch("https://pusatpneumatic.com/absen/parse.php",{method:"POST",body:p})).text();console.log("Raw response dari parse.php:",g);let m;try{m=JSON.parse(g)}catch(i){console.error("Error parsing JSON dari parse.php:",i.message,g),t.innerText="‚ùå Parse gagal: Respons server bukan JSON valid. Periksa console log.";return}if(!m.success){t.innerText="‚ö†Ô∏è Parsing gagal: "+m.message;return}t.innerText="‚úÖ Sukses! Data berhasil diparse"}catch(e){t.innerText="‚ùå Terjadi kesalahan: "+e.message}});function v(r){if(!r||typeof r!="string")return null;const[c,s]=r.split(":").map(Number);return c*60+s}function j(r){const c=Math.floor(r/60),s=r%60;return`${c}j ${s}m`}function A(r){if(!r)return!1;const s=r.replace(/\//g,"-").split("-").map(Number);let t,e,a;s[0]>=1900?[t,e,a]=s:s[2]>=1900?[a,e,t]=s:[t,e,a]=s;const n=new Date(t,(e??1)-1,a??1);return!Number.isNaN(n.getTime())&&n.getDay()===6}function C(r){return r<=5?0:r<=15?1e4:r<=30?25e3:r<=60?5e4:1e5}let P=new Set;function K(r){return P.has(r)}function _(r,c){const s=[],t=new Date(r,c,0).getDate();for(let e=1;e<=t;e++){const a=`${r}-${String(c).padStart(2,"0")}-${String(e).padStart(2,"0")}`;new Date(`${a}T00:00:00`).getDay()!==0&&(K(a)||s.push(a))}return s}function F({summaryId:r,detailId:c,tabSummaryId:s,tabDetailId:t}){const e=document.getElementById(s),a=document.getElementById(t),n=document.getElementById(r),o=document.getElementById(c);e.addEventListener("click",()=>{n.classList.remove("hidden"),o.classList.add("hidden"),e.classList.replace("bg-gray-200","bg-blue-600"),e.classList.replace("text-gray-700","text-white"),a.classList.replace("bg-blue-600","bg-gray-200"),a.classList.replace("text-white","text-gray-700")}),a.addEventListener("click",()=>{n.classList.add("hidden"),o.classList.remove("hidden"),a.classList.replace("bg-gray-200","bg-blue-600"),a.classList.replace("text-gray-700","text-white"),e.classList.replace("bg-blue-600","bg-gray-200"),e.classList.replace("text-white","text-gray-700")})}function U(r){const c=[];for(const s in r){const t=r[s],e=t.find(o=>o.type==="in")?.time||null,a=[...t].reverse().find(o=>o.type==="out")?.time||null,n=[];for(let o=0;o<t.length-1;o++)if(t[o].type==="out"&&t[o+1].type==="in"){const p=v(t[o+1].time)-v(t[o].time);p>0&&n.push(p)}c.push({tanggal:s,jamMasuk:e,jamKeluar:a,breaks:n,isEmpty:!e&&!a,holiday:K(s)})}return c}function q(r){if(!r.length)return null;const c=r.map(l=>l.tanggal),s=v(R),[t,e]=c[0].split("-").map(Number),a=_(t,e),n=new Set;let o=0,p=0,w=0,g=0,m=0,i=0,S=0,E=0;for(const l of r){const d=v(A(l.tanggal)?H:O);if(l.holiday&&!l.jamMasuk&&!l.jamKeluar){E++;continue}const x=v(l.jamMasuk),b=v(l.jamKeluar);if(x===null||b===null){S++;continue}n.add(l.tanggal);const L=b-x;o+=L;const k=x-s;k>B&&(m+=k,g+=C(k));const D=d-b;D>B&&(i+=D);const I=b-d;I>B&&(p+=I),w+=l.breaks.reduce(($,M)=>$+M,0)}const N=a.filter(l=>!n.has(l)).length,u=Math.floor(p/60)*J,y=Math.max(u-g,0),h=a.reduce((l,d)=>{const f=v(A(d)?H:O);return l+(f-s)},0);return console.log(`üìä Lembur: ${j(p)}, Kotor: Rp${u}, Denda: Rp${g}, Bersih: Rp${y}`),{jamKerjaIdeal:j(h),workMinutes:o,workHours:j(o),lemburHours:j(p),uangLemburKotor:u,dendaTelat:g,uangLembur:y,telatHours:j(m),earlyOutHours:j(i),absenceDays:N,missingDays:S,holidayDays:E,breakHours:j(w)}}document.addEventListener("DOMContentLoaded",async()=>{function r(){const t=document.getElementById("yearSelect")?.value,e=document.getElementById("monthSelect")?.value;return`https://pusatpneumatic.com/absen/json/${t}/${t}-${e}.json`}async function c(){const t=r();try{let S=function(){const u=p.value.toLowerCase();i.querySelectorAll("tr").forEach(y=>{const h=y.children[0].textContent.toLowerCase(),l=y.children[1].textContent.replaceAll("\\/","/"),d=new Date(l),f=h.includes(u);y.style.display=f?"":"none"}),g.querySelectorAll("tr").forEach(y=>{const l=y.children[0].textContent.toLowerCase().includes(u);y.style.display=l?"":"none"})},N=function(u,y=!1){const h=Array.from(i.querySelectorAll("tr")),l=E[u]==="asc"?"desc":"asc";E[u]=l,h.sort((d,f)=>{const x=d.children[u].textContent.trim(),b=f.children[u].textContent.trim();let L;return y?L=new Date(x)-new Date(b):!isNaN(x)&&!isNaN(b)?L=Number(x)-Number(b):L=x.localeCompare(b),l==="asc"?L:-L}),i.innerHTML="",h.forEach(d=>i.appendChild(d))};var e=S,a=N;const n=await fetch(t);if(!n.ok)throw new Error("Gagal memuat data JSON");const o=await n.json(),p=document.getElementById("filterName"),w=document.getElementById("summaryHead"),g=document.getElementById("summaryBody"),m=document.getElementById("detailHead"),i=document.getElementById("detailBody");g.innerHTML="",i.innerHTML="",o.forEach(u=>{const{nama:y,logs:h}=u,l=U(u.logs),d=q(l);w.innerHTML=`
          <tr>
            <th class="px-4 py-3 border-b text-left">Nama</th>
            <th class="px-4 py-3 border-b text-center">Work<br>(${d.jamKerjaIdeal} jam)</th>
            <th class="px-4 py-3 border-b text-center">Lembur (jam)</th>
            <th class="px-4 py-3 border-b text-center">Uang Lembur</th>
            <th class="px-4 py-3 border-b text-center">Telat (jam)</th>
            <th class="px-4 py-3 border-b text-center">Early Out</th>
            <th class="px-4 py-3 border-b text-center">Absence</th>
            <th class="px-4 py-3 border-b text-center">Break (jam)</th>
          </tr>
        `,m.innerHTML=`
          <tr class="bg-gradient-to-r from-blue-200 to-blue-400 text-gray-800 font-semibold text-sm shadow-sm">
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="nama">Nama</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="tanggal">Tanggal</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Masuk</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Break-Out</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Break-In</th>
            <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Keluar</th>
            <th class="px-1 py-3 border-b border-gray-300 text-center cursor-pointer rounded-tr-lg w-30" data-sort="keluar">MT</th>
          </tr>
        `,Object.entries(h).forEach(([x,b])=>{const L=b.find(T=>T.type==="in")?.time||"-",k=b.slice().reverse().find(T=>T.type==="out")?.time||"-",D=b.find(T=>T.type==="break-in")?.time||"-",I=b.slice().reverse().find(T=>T.type==="break-out")?.time||"-",$=L==="-"||k==="-"?"‚ö†Ô∏è":"",M=document.createElement("tr");M.className="hover:bg-blue-50 transition-colors",M.innerHTML=`
            <td class="px-4 py-3 border-b text-sm font-medium text-gray-700">${y}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-gray-600">${x.replaceAll("\\/","/")}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-green-700 font-semibold">${L}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${I}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${D}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${k}</td>
            <td class="px-4 py-3 border-b text-center text-sm">${$}</td>
          `,i.appendChild(M)});const f=document.createElement("tr");f.className="hover:bg-blue-50 transition-colors",f.innerHTML=`
          <td class="px-4 py-3 text-sm font-medium text-gray-800">${u.nama}</td>
          <td class="px-4 py-3 text-center">${d.workHours}</td>
          <td class="px-4 py-3 text-center text-green-700 font-semibold">${d.lemburHours}</td>
          <td class="px-4 py-3 text-center font-semibold relative group cursor-pointer ${d.uangLembur<0?"text-red-700":"text-green-800"}">
            Rp${d.uangLembur.toLocaleString()}
            <div class="absolute z-10 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max px-3 py-1 bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
              Rp${d.uangLemburKotor.toLocaleString()} - Rp${d.dendaTelat.toLocaleString()}
            </div>
          </td>
          <td class="px-4 py-3 text-center text-red-700">${d.telatHours}</td>
          <td class="px-4 py-3 text-center">${d.earlyOutHours}</td>
          <td class="px-4 py-3 text-center">${d.absenceDays}</td>
          <td class="px-4 py-3 text-center">${d.breakHours}</td>
        `,g.appendChild(f)});let E={};m.querySelectorAll("th").forEach((u,y)=>{const h=u.dataset.sort;h&&u.addEventListener("click",()=>{N(y,h==="tanggal")})}),[p].forEach(u=>u.addEventListener("input",S))}catch(n){console.error("‚ùå Gagal memuat JSON:",n),document.getElementById("message").innerText="Gagal memuat data. Periksa file JSON."}}async function s(){const t=document.getElementById("yearSelect"),e=document.getElementById("monthSelect"),n=await(await fetch("https://pusatpneumatic.com/absen/json/list_index.json")).json();Object.keys(n).sort().forEach(m=>{const i=document.createElement("option");i.value=m,i.textContent=m,t.appendChild(i)}),t.addEventListener("change",()=>{const m=t.value,i=n[m]||[];e.innerHTML="",i.forEach(S=>{const E=document.createElement("option");E.value=S,E.textContent=S,e.appendChild(E)}),c()}),e.addEventListener("change",c);const o=new Date,p=o.getFullYear().toString(),w=String(o.getMonth()+1).padStart(2,"0");t.value=p;const g=n[p];g&&(g.forEach(m=>{const i=document.createElement("option");i.value=m,i.textContent=m,e.appendChild(i)}),e.value=w),c()}await s(),F({summaryId:"summaryTab",detailId:"detailTab",tabSummaryId:"tabSummary",tabDetailId:"tabDetail"})});
