(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();const A="https://pusatpneumatic.com/absen",_=480,$=960,P=840,x=5,N=5e3;function w(o,a="info"){const r=document.getElementById("message");r.textContent=o,r.classList.remove("bg-blue-600","bg-red-600","bg-green-600"),a==="error"?r.classList.add("bg-red-600"):a==="success"?r.classList.add("bg-green-600"):r.classList.add("bg-blue-600"),r.classList.remove("opacity-0"),r.classList.add("opacity-100"),setTimeout(()=>{r.classList.remove("opacity-100"),r.classList.add("opacity-0")},3e3)}document.getElementById("upload-form").addEventListener("submit",async function(o){o.preventDefault();const a=document.querySelector('input[type="file"]'),r=new FormData;r.append("csvFile",a.files[0]),w("⏳ Uploading...","info");try{const e=await(await fetch(`${A}/upload.php`,{method:"POST",body:r})).text();let t;try{t=JSON.parse(e)}catch(s){console.error("Error parsing JSON dari upload.php:",s.message,e),w("❌ Upload gagal: respons server bukan JSON valid.","error");return}if(!t.success){w("❌ Upload gagal: "+t.message,"error");return}w("✅ Sukses! Data berhasil diparse","success"),console.log("Parsed data:",t.parse_log),t.parse_log&&t.parse_log.data&&console.log("User Logs:",t.parse_log.data)}catch(n){w("❌ Terjadi kesalahan: "+n.message,"error")}});function R(o,a,r=[],n=[]){const e=document.querySelectorAll(o),t=document.querySelectorAll(a);if(e.forEach(s=>{s.addEventListener("click",()=>{const u=s.getAttribute("data-target"),c=document.getElementById(u);t.forEach(l=>l.classList.add("hidden")),e.forEach(l=>{n.forEach(y=>l.classList.add(y)),r.forEach(y=>l.classList.remove(y))}),c.classList.remove("hidden"),r.forEach(l=>s.classList.add(l)),n.forEach(l=>s.classList.remove(l))})}),e.length>0&&t.length>0){const s=e[0],u=s.getAttribute("data-target");document.getElementById(u).classList.remove("hidden"),r.forEach(l=>s.classList.add(l)),n.forEach(l=>s.classList.remove(l))}}function k(o){if(o==null)return"-";const a=Math.floor(o/60),r=String(o%60).padStart(2,"0");return`${a}:${r}`}const C=[[5,0],[15,1e4],[30,25e3],[60,5e4],[1/0,1e5]];function U(o){return C.find(([a])=>o<=a)[1]}function F(o,a,r){const n=new Date(o,a-1,r);return n.getDay()===6||n.getDay()===0}function q(o){const a=o.i||{},r=a.m||0,n=a.k||0,e=a.l||0;return{minutes:r,formatted:k(r),hariKerja:n,hariLibur:e}}function G(o){return Array.isArray(o)?o.map((a,r)=>{const n=r+1;if(typeof a=="number")return{tanggal:n,jamMasuk:null,jamKeluar:null,breaks:[],isEmpty:!0,holiday:a===2,status:a};const e=a.l||[];let t=null,s=null;const u=[];return e.forEach((c,l)=>{const[y,g]=c;if(g===0&&!t&&(t=y),g===1&&(s=y),l<e.length-1){const[L,j]=e[l+1];if(g===2&&j===3){const E=L-y;E>0&&u.push(E)}}}),{tanggal:n,jamMasuk:t,jamKeluar:s,breaks:u,isEmpty:!t&&!s,holiday:a.s===2,status:a.s}}):(console.warn("normalizeLogs: input bukan array",o),[])}async function V(o,a,r="",n,e){if(!o||o.length===0)return{workMinutes:0,workHours:"00:00",lemburHours:"00:00",uangLemburKotor:0,jamKerjaIdeal:"00:00",dendaTelat:0,uangLembur:0,telatHours:"00:00",earlyOutHours:"00:00",absenceDays:0,missingDays:0,holidayDays:0,breakHours:"00:00"};let t=0,s=0,u=0,c=0,l=0,y=0,g=0,L=0;const j=new Set,E=[],H=[];o.forEach(i=>{if(i.holiday&&!i.jamMasuk&&!i.jamKeluar){L++;return}if(j.add(i.tanggal),!i.jamMasuk||!i.jamKeluar){g++;return}const p=i.jamMasuk,f=i.jamKeluar,b=F(n,e,i.tanggal)?P:$,h=f-p;t+=h;const d=p-_;if(d>x){l+=d;const B=U(d);c+=B,E.push({tanggal:i.tanggal,telat:d,denda:B})}const v=b-f;v>x&&(y+=v);const m=f-b;m>x&&(s+=m,H.push({tanggal:i.tanggal,lembur:m}));const S=i.breaks.reduce((B,J)=>B+J,0);u+=S});const I=o.filter(i=>!i.holiday&&i.isEmpty).length,T=Math.floor(s/60)*N,M=Math.max(T-c,0);return a&&(H.map(i=>i.lembur).join(" + "),H.reduce((i,p)=>i+p.lembur,0)),{workMinutes:t,workHours:k(t),lemburHours:k(s),uangLemburKotor:T,dendaTelat:c,uangLembur:M,telatHours:k(l),earlyOutHours:k(y),absenceDays:I,missingDays:g,holidayDays:L,breakHours:k(u),dendaPerHari:E}}async function Y(o){const a=document.getElementById("yearSelect"),r=document.getElementById("monthSelect"),n=Object.keys(o).sort().reverse();n.forEach(u=>{const c=document.createElement("option");c.value=u,c.textContent=u,a.appendChild(c)});const e=n[0],t=o[e]?o[e].sort().reverse():[],s=t[0];return a.value=e,r.innerHTML="",t.forEach(u=>{const c=document.createElement("option");c.value=u,c.textContent=u,r.appendChild(c)}),r.value=s,{year:e,month:s}}async function z(o,a){const r=document.getElementById("monthSelect"),n=o[a]||[];return r.innerHTML="",n.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),n[0]||null}function O(o,a,r=""){a.innerHTML=`
    <tr class="${r}">
      ${o.map(n=>`
        <th 
          class="px-4 py-3 border-b text-center cursor-pointer"
          data-type="${n.type||"string"}"
          data-sort="${n.key}"
        >${n.label}</th>
      `).join("")}
    </tr>
  `}function D(o,a,r){a.innerHTML=o.map(n=>`
    <tr>
      ${r.map(e=>`
        <td class="px-4 py-2 border text-center">${n[e.key]??"-"}</td>
      `).join("")}
    </tr>
  `).join("")}function K(o,a,r,n="asc"){const e=Array.from(o.querySelectorAll("tr")),t=s=>{const u=s.textContent.trim();if(r==="number")return parseFloat(u)||0;if(r==="time"){const[c,l]=u.split(":").map(Number);return c*60+(l||0)}return u.toLowerCase()};e.sort((s,u)=>{const c=t(s.children[a]),l=t(u.children[a]);return n==="asc"?c-l:l-c}),o.innerHTML="",e.forEach(s=>o.appendChild(s))}document.addEventListener("DOMContentLoaded",async()=>{function o(){const n=document.getElementById("yearSelect")?.value,e=document.getElementById("monthSelect")?.value;return`${A}/json/${n}/${n}-${e}.json`}async function a(){const n=o();try{let i=function(){const p=u.value.toLowerCase();[g,l].forEach(f=>{f.querySelectorAll("tr").forEach(b=>{const h=b.children[0]?.textContent?.toLowerCase()||"";b.style.display=h.includes(p)?"":"none"})})};var e=i;const t=await fetch(n);if(!t.ok)throw new Error("Gagal memuat data JSON");const s=await t.json(),u=document.getElementById("filterName"),c=document.getElementById("summaryHead"),l=document.getElementById("summaryBody"),y=document.getElementById("detailHead"),g=document.getElementById("detailBody"),L=q(s),j=[{key:"nama",label:"Nama",type:"string"},{key:"workHours",label:`Work<br>${L.formatted}`,type:"time"},{key:"lemburHours",label:"Lembur (jam)",type:"time"},{key:"uangLembur",label:"Uang Lembur",type:"string"},{key:"telatHours",label:"Telat (jam)",type:"time"},{key:"earlyOutHours",label:"Early Out",type:"time"},{key:"absenceDays",label:"Absence",type:"number"},{key:"breakHours",label:"Break (jam)",type:"time"}],E=[{key:"nama",label:"Nama",type:"string"},{key:"tanggal",label:"Tanggal",type:"number"},{key:"jamMasuk",label:"Jam Masuk",type:"time"},{key:"breakOut",label:"Jam Break-Out",type:"time"},{key:"breakIn",label:"Jam Break-In",type:"time"},{key:"jamKeluar",label:"Jam Keluar",type:"time"},{key:"ket",label:"KET",type:"string"}];l.innerHTML="",g.innerHTML="",O(j,c,"text-gray-800 font-semibold text-sm shadow-sm"),O(E,y,"text-gray-800 font-semibold text-sm shadow-sm");const H=[],I=[],T=s.u||[];for(const p of T){const f=p.n,b=(p.d||[]).map(m=>typeof m=="number"?{s:m,l:[]}:m),h=G(b),d=await V(h,L,f,s.y,s.m);H.push({nama:f,workHours:d.workHours,lemburHours:d.lemburHours,uangLembur:`Rp${d.uangLembur.toLocaleString()}`,telatHours:d.telatHours,earlyOutHours:d.earlyOutHours,absenceDays:d.absenceDays,breakHours:d.breakHours});const v=h.map(m=>{let S="";return m.status===1?S="Tidak hadir":m.status===2?S="Libur":m.isEmpty?S="Missing Time":m.holiday===1&&(S="Tanggal Merah"),{nama:f,tanggal:m.tanggal,jamMasuk:k(m.jamMasuk),breakOut:m.breaks.length>=1?k(m.breaks[0]):"-",breakIn:m.breaks.length>=2?k(m.breaks.at(-1)):"-",jamKeluar:k(m.jamKeluar),ket:S}});I.push(...v)}D(H,l,j),D(I,g,E);const M={};y.querySelectorAll("th").forEach((p,f)=>{p.addEventListener("click",()=>{const b=p.dataset.type||"string",h=`detail-${f}`,d=M[h]==="asc"?"desc":"asc";M[h]=d,K(g,f,b,d)})}),c.querySelectorAll("th").forEach((p,f)=>{p.addEventListener("click",()=>{const b=p.dataset.type||"string",h=`summary-${f}`,d=M[h]==="asc"?"desc":"asc";M[h]=d,K(l,f,b,d)})}),u.addEventListener("input",i)}catch(t){console.error("❌ Gagal memuat JSON:",t);const s=document.getElementById("message");s&&(s.innerText="Gagal memuat data. Periksa file JSON.")}}async function r(){try{const n=await fetch(`${A}/json/list_index.json`);if(!n.ok)throw new Error("Failed to fetch list_index.json");const e=await n.json(),s=Object.keys(e).sort().reverse()[0],c=e[s].sort().reverse()[0],{year:l}=await Y(e,s,c),y=document.getElementById("yearSelect"),g=document.getElementById("monthSelect");y.addEventListener("change",async()=>{await z(e,y.value),a()}),g.addEventListener("change",a),a()}catch(n){console.error("❌ Error initializing period selectors:",n);const e=document.getElementById("message");e&&(e.innerText="Gagal memuat daftar tahun/bulan. Periksa file list_index.json.")}}await r(),R(".tab-btn",".tab-panel",["bg-blue-600","text-white"],["bg-gray-200","text-gray-700"])});
