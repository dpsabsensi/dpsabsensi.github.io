(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=e(t);fetch(t.href,n)}})();const v="08:00",B="16:00",H="14:00",$=5,O=5e3;document.getElementById("upload-form").addEventListener("submit",async function(r){r.preventDefault();const s=document.querySelector('input[type="file"]'),e=new FormData;e.append("csvFile",s.files[0]);const a=document.getElementById("message");a.innerText="⏳ Uploading...";try{const n=await(await fetch("https://pusatpneumatic.com/absen/upload.php",{method:"POST",body:e})).text();let o;try{o=JSON.parse(n)}catch(c){console.error("Error parsing JSON dari upload.php:",c.message,n),a.innerText="❌ Upload gagal: Respons server bukan JSON valid. Periksa console log.";return}if(!o.success){a.innerText="❌ Upload gagal: "+o.message;return}a.innerText="✅ Sukses! Data berhasil diparse",console.log("Parsed data:",o.parse_log),o.parse_log&&o.parse_log.data&&console.log("User Logs:",o.parse_log.data)}catch(t){a.innerText="❌ Terjadi kesalahan: "+t.message}});function L(r){if(!r)return null;const[s,e]=r.split(":").map(Number);return s*60+e}function k(r){const s=Math.floor(r/60),e=r%60;return`${s}j ${e}m`}const A=[[5,0],[15,1e4],[30,25e3],[60,5e4],[1/0,1e5]];function K(r){return A.find(([s])=>r<=s)[1]}function D(r){return new Date(r).getDay()===6}function C(r){if(!r)return"";if(r instanceof Date){const e=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${e}-${a}-${t}`}let s=String(r).trim();if(s.includes("/")){const[e,a,t]=s.split("/");if(e.length<=2&&a.length<=2&&t.length===4)return`${t}-${String(e).padStart(2,"0")}-${String(a).padStart(2,"0")}`;if(e.length===4)return`${e}-${String(a).padStart(2,"0")}-${String(t).padStart(2,"0")}`}if(s.includes("-")){const[e,a,t]=s.split("-");if(e.length===4)return`${e}-${String(a).padStart(2,"0")}-${String(t).padStart(2,"0")}`}return s}function J(r){return Object.entries(r).map(([s,e])=>{const a=e.l||[];let t=null,n=null;const o=[];return a.forEach((c,p)=>{const[j,f]=c;if(f===0&&!t&&(t=j),f===1&&(n=j),p<a.length-1){const[T,g]=a[p+1];if(f===3&&g===2){const M=L(T)-L(j);M>0&&o.push(M)}}}),{tanggal:C(s),jamMasuk:t,jamKeluar:n,breaks:o,isEmpty:!t&&!n,holiday:e.s===2,status:e.s}})}async function _(r){if(!r||r.length===0)return{workMinutes:0,workHours:"0j 0m",lemburHours:"0j 0m",uangLemburKotor:0,jamKerjaIdeal:"0j 0m",dendaTelat:0,uangLembur:0,telatHours:"0j 0m",earlyOutHours:"0j 0m",absenceDays:0,missingDays:0,holidayDays:0,breakHours:"0j 0m"};let s=0,e=0,a=0,t=0,n=0,o=0,c=0,p=0;const j=new Set,f=[];r.forEach(l=>{if(l.holiday&&!l.jamMasuk&&!l.jamKeluar){p++;return}if(j.add(l.tanggal),!l.jamMasuk||!l.jamKeluar){c++;return}const S=L(l.jamMasuk),d=L(l.jamKeluar),u=L(D(l.tanggal)?H:B),b=d-S;s+=b;const h=S-L(v);if(h>$){n+=h;const y=K(h);t+=y}const m=u-d;m>$&&(o+=m);const E=d-u;E>$&&(e+=E);const i=l.breaks.reduce((y,x)=>y+x,0);a+=i});const T=r.filter(l=>!l.holiday&&l.isEmpty).length,g=Math.floor(e/60)*O,M=Math.max(g-t,0),w=r.reduce((l,S)=>{if(S.holiday)return l;const d=L(D(S.tanggal)?H:B),u=L(v);return l+(d-u)},0);return{workMinutes:s,workHours:k(s),lemburHours:k(e),uangLemburKotor:g,jamKerjaIdeal:k(w),dendaTelat:t,uangLembur:M,telatHours:k(n),earlyOutHours:k(o),absenceDays:T,missingDays:c,holidayDays:p,breakHours:k(a),dendaPerHari:f}}function R({summaryId:r,detailId:s,tabSummaryId:e,tabDetailId:a}){const t=document.getElementById(e),n=document.getElementById(a),o=document.getElementById(r),c=document.getElementById(s);t.addEventListener("click",()=>{o.classList.remove("hidden"),c.classList.add("hidden"),t.classList.replace("bg-gray-200","bg-blue-600"),t.classList.replace("text-gray-700","text-white"),n.classList.replace("bg-blue-600","bg-gray-200"),n.classList.replace("text-white","text-gray-700")}),n.addEventListener("click",()=>{o.classList.add("hidden"),c.classList.remove("hidden"),n.classList.replace("bg-gray-200","bg-blue-600"),n.classList.replace("text-gray-700","text-white"),t.classList.replace("bg-blue-600","bg-gray-200"),t.classList.replace("text-white","text-gray-700")})}async function P(r){const s=document.getElementById("yearSelect"),e=document.getElementById("monthSelect");Object.keys(r).sort().forEach(c=>{const p=document.createElement("option");p.value=c,p.textContent=c,s.appendChild(p)});const a=new Date,t=a.getFullYear().toString(),n=String(a.getMonth()+1).padStart(2,"0");s.value=t;const o=r[t];return o&&(e.innerHTML="",o.forEach(c=>{const p=document.createElement("option");p.value=c,p.textContent=c,e.appendChild(p)}),e.value=n),{year:t,month:n}}async function F(r,s){const e=document.getElementById("monthSelect"),a=r[s]||[];return e.innerHTML="",a.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}),a[0]||null}document.addEventListener("DOMContentLoaded",async()=>{function r(){const a=document.getElementById("yearSelect")?.value,t=document.getElementById("monthSelect")?.value;return`https://pusatpneumatic.com/absen/json/${a}/${a}-${t}.json`}async function s(){const a=r();try{let w=function(){const d=p.value.toLowerCase();g.querySelectorAll("tr").forEach(u=>{const b=u.children[0].textContent.toLowerCase();u.style.display=b.includes(d)?"":"none"}),f.querySelectorAll("tr").forEach(u=>{const b=u.children[0].textContent.toLowerCase();u.style.display=b.includes(d)?"":"none"})},S=function(d,u=!1){const b=Array.from(g.querySelectorAll("tr")),h=l[d]==="asc"?"desc":"asc";l[d]=h,b.sort((m,E)=>{const i=m.children[d].textContent.trim(),y=E.children[d].textContent.trim();let x;return u?x=new Date(i)-new Date(y):!isNaN(i)&&!isNaN(y)?x=Number(i)-Number(y):x=i.localeCompare(y),h==="asc"?x:-x}),g.innerHTML="",b.forEach(m=>g.appendChild(m))};var t=w,n=S;const o=await fetch(a);if(!o.ok)throw new Error("Gagal memuat data JSON");const c=await o.json(),p=document.getElementById("filterName"),j=document.getElementById("summaryHead"),f=document.getElementById("summaryBody"),T=document.getElementById("detailHead"),g=document.getElementById("detailBody");f.innerHTML="",g.innerHTML="",j.innerHTML=`
        <tr>
          <th class="px-4 py-3 border-b text-left">Nama</th>
          <th class="px-4 py-3 border-b text-center">Work</th>
          <th class="px-4 py-3 border-b text-center">Lembur (jam)</th>
          <th class="px-4 py-3 border-b text-center">Uang Lembur</th>
          <th class="px-4 py-3 border-b text-center">Telat (jam)</th>
          <th class="px-4 py-3 border-b text-center">Early Out</th>
          <th class="px-4 py-3 border-b text-center">Absence</th>
          <th class="px-4 py-3 border-b text-center">Break (jam)</th>
        </tr>
      `,T.innerHTML=`
        <tr class="bg-gradient-to-r from-blue-200 to-blue-400 text-gray-800 font-semibold text-sm shadow-sm">
          <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="nama">Nama</th>
          <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="tanggal">Tanggal</th>
          <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="masuk">Jam Masuk</th>
          <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="breakout">Jam Break-Out</th>
          <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="breakin">Jam Break-In</th>
          <th class="px-4 py-3 border-b border-gray-300 text-center cursor-pointer" data-sort="keluar">Jam Keluar</th>
          <th class="px-1 py-3 border-b border-gray-300 text-center rounded-tr-lg w-30">KET</th>
        </tr>
      `;const M=c.u||[];for(const d of M){const u=d.n,b=d.d||{},h=J(b),m=await _(h);h.length===0&&h.push({tanggal:"-",jamMasuk:"-",jamKeluar:"-",breaks:[],status:0,holiday:0}),h.forEach(i=>{let y="";i.status===1?y="Tidak hadir":i.status===2?y="Libur":i.isEmpty?y="Missing Time":i.holiday===1&&(y="Tanggal Merah");const x=i.breaks.length?k(i.breaks[0]):"-",N=i.breaks.length?k(i.breaks[i.breaks.length-1]):"-",I=document.createElement("tr");I.className="hover:bg-blue-50 transition-colors",I.innerHTML=`
            <td class="px-4 py-3 border-b text-sm font-medium text-gray-700">${u}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-gray-600">${i.tanggal}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-green-700 font-semibold">${i.jamMasuk||"-"}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${x}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${N}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-red-700 font-semibold">${i.jamKeluar||"-"}</td>
            <td class="px-4 py-3 border-b text-center text-sm text-blue-700">${y}</td>
          `,g.appendChild(I)});const E=document.createElement("tr");E.className="hover:bg-blue-50 transition-colors",E.innerHTML=`
          <td class="px-4 py-3 text-sm font-medium text-gray-800">${u}</td>
          <td class="px-4 py-3 text-center">${m.workHours}</td>
          <td class="px-4 py-3 text-center text-green-700 font-semibold">${m.lemburHours}</td>
          <td class="px-4 py-3 text-center font-semibold relative group cursor-pointer ${m.uangLembur<0?"text-red-700":"text-green-800"}">
            Rp${m.uangLembur.toLocaleString()}
            <div class="absolute z-10 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max px-3 py-1 bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
              Rp${m.uangLemburKotor.toLocaleString()} - Rp${m.dendaTelat.toLocaleString()}
            </div>
          </td>
          <td class="px-4 py-3 text-center text-red-700">${m.telatHours}</td>
          <td class="px-4 py-3 text-center">${m.earlyOutHours}</td>
          <td class="px-4 py-3 text-center">${m.absenceDays}</td>
          <td class="px-4 py-3 text-center">${m.breakHours}</td>
        `,f.appendChild(E)}let l={};T.querySelectorAll("th").forEach((d,u)=>{const b=d.dataset.sort;b&&d.addEventListener("click",()=>S(u,b==="tanggal"))}),p.addEventListener("input",w)}catch(o){console.error("❌ Gagal memuat JSON:",o);const c=document.getElementById("message");c&&(c.innerText="Gagal memuat data. Periksa file JSON.")}}async function e(){const t=await(await fetch("https://pusatpneumatic.com/absen/json/list_index.json")).json(),{year:n}=await P(t),o=document.getElementById("yearSelect"),c=document.getElementById("monthSelect");o.addEventListener("change",async()=>{await F(t,o.value),s()}),c.addEventListener("change",s),s()}await e(),R({summaryId:"summaryTab",detailId:"detailTab",tabSummaryId:"tabSummary",tabDetailId:"tabDetail"})});
